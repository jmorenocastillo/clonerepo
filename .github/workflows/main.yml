# .github/workflows/setup-environments.yml
name: Setup Environments + Aprobadores

on:
  workflow_dispatch:   # Ejecuta manualmente una vez

jobs:
  create-envs:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: Crear environments con aprobadores
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}   # <-- Crea este secret con un PAT (repo scope)
        run: |
          OWNER="jmorenocastillo"           # <-- Cambia aquí (ej: microsoft o tu-usuario)
          REPO="clonerepo"                     # <-- Cambia aquí
          USERNAME="jmorenocastillo"     # <-- Usuario GitHub que será aprobador
          TEAM_SLUG=""     # <-- Slug del team (opcional, déjalo vacío si no usas team)

          # Lista de environments que quieres crear
          for ENV in dev staging production; do
            echo "Configurando environment: $ENV"

            # Obtener ID del usuario
            USER_ID=$(curl -s -H "Authorization: token $GH_TOKEN" \
              https://api.github.com/users/$USERNAME | jq -r .id)

            # Construir reviewers